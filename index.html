<html>

<head>
	<script src="https://cdn.firebase.com/js/client/2.2.4/firebase.js">
	</script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js">
	</script>
	<script>
		function testAuth() {
			var fbref = new Firebase("https://ccim2.firebaseio.com/keys/")
			var fb = new Firebase("https://ccim2.firebaseio.com/sessions/")
			var key = localStorage.getItem("key");
			// var sessionKey = sessionStorage.getItem("sessionKey");
			/*fb*/fbref.once("value", function(snapshot) {
				console.log(snapshot.child(/* sessionKey */ key).val());
				console.log(localStorage.getItem("username"));
				console.log(sessionStorage.getItem("auth"));
				if (sessionStorage.getItem("auth") === "true" && snapshot.child(/* sessionKey */ key).val() === localStorage.getItem("username")) {
					fbref.child(key).set(null);

					fbref.authWithCustomToken(localStorage.getItem("token"), function(error, authData) {
						if (error) {
							console.log("Login Failed!", error);
						}
						else {
							console.log("Login Succeeded!", authData);
						}
					});
					return true;
				} else {
					return false;
				}
			});

		}
		$(document).ready(function() {
			if (!testAuth()) {
				console.log("redirect");
				// window.location.href = "login.html";
			}
		});
	</script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="style.min.css">

	<noscript>
		<meta http-equiv="refresh" content="0; url=http://im.clubcoder.tk/noscript.html">
	</noscript>
	<style>

	</style>
	<title>Club Coder Instant Messenger</title>
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

</head>

<body>

	<div class="container">


		<div class="row">
			<div class="box">
				<div class="col-lg-12">
					<br>

					<h1 class="intro">Welcome to the Club Coder instant messenger</h1>
					<br>
					<p class="options popout-hidden">Version 2.2.1</p>

					<div id="message" class="col-lg-12"></div>

					<br>
					<textarea placeholder="type a message!" id="text" class="form-control" class="text-ab45"></textarea>
					<br>
					<button class="form-control btn btn-success transparent" id="submit">Enter</button>
					<div class="popout-hidden options">
						<div>
							<p> <a id="popout">Pop Out <i class="fa fa-external-link"></i></a> | <span><a id="view-image">View Image <i class="fa fa-picture-o"></i>
</a></span> | <a onclick="slide()">Change Image</a> | <a id="logout">Logout <i class="fa fa-sign-out"></i></a> | <a id="help">Help <i class="fa fa-info-circle"></i></a> |
								<input type="checkbox" id="autoscroll" value="true" checked>Autoscroll on new
							</p>
						</div>
					</div>

					<footer>
						<div class="container">
							<div class="col-lg-12 options">
								<p>&copy; 2015-2016 Jeffrey Meng. All Rights Reserved.</p>
							</div>
						</div>
					</footer>


					<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
					<script src="markdown.js"></script>

					<script src="script.min.js"></script>
					<script src="timeago.min.js" type="text/javascript"></script>

				</div>
			</div>
		</div>

	</div>
	<div id="myModal" class="modal fade modal-wide" role="dialog">
		<div class="modal-dialog">

			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">Help</h4>
				</div>
				<div class="modal-body">
					<p>Type in a message and press enter or click enter to send. Messages cannot be just a space, empty, or start with a slash(If a message starts with a slash, it is a command see below). To create a new line, type in \n note. Markdown is enabled(see below).
					</p>
					<h4>Commands</h4>
					<p>There is currently only one command you can use.</p>
					<p>
						/msg sends a private message. It's syntax is: <code>/msg[recipents] &lt;message></code>, where
						<cpde>recipents</code> is a space seperated list of recipents, For example: <code>/msg[joe bob billy] &lt;message></code> sengs a message to joe, bob, and billy only. No one else can see it. The <code>&lt;message></code> parameter is your message. for
							example: if you do <code>/msg [billy] Hello. Only you can see this.</code>
							<br> Only billy and you will be able to see the message, which is: Hello. Only you can see this.
					</p>
					<h4>Markdown</h4>
					<iframe src="http://tinyurl.com/jcjj75s" class="modal-wide" style="width:95%;height:1000px;">Loading</iframe>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				</div>
			</div>

		</div>
	</div>
</body>

</html>
