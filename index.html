
<html>
<head>
    <script src="https://cdn.firebase.com/js/client/2.2.4/firebase.js">
                     </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js">
    </script>
    <script>
    function testAuth() {
        var fbref = new Firebase("https://ccim2.firebaseio.com/keys/")
        var fb = new Firebase("https://ccim2.firebaseio.com/sessions/")
        var key = localStorage.getItem("key");
        var sessionKey = sessionStorage.getItem("sessionKey")
        fb.once("value", function(snapshot) {
          console.log(snapshot.child(sessionKey).val())
          console.log(localStorage.getItem("username"))
          if (sessionStorage.getItem("auth") === "true" && snapshot.child(sessionKey).val() === localStorage.getItem("username") ){
            fbref.child(key).set(null)

            fbref.authWithCustomToken(localStorage.getItem("token"), function(error, authData) {
              if (error) {
                console.log("Login Failed!", error);
              } else {
                console.log("Login Succeeded!", authData);
                if (localStorage.getItem("reload") === "false") {
                  localStorage.setItem("reload", "true")
                  window.location.reload()
                } else {

                }
              }
            });
            return true;
        } else {
            return false;
        }
        });
        
    }
    $(document).ready(function(){if (!testAuth()) {
      console.log("redirect")
        // window.location.href = "login.html";
    }})
    
    

    </script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="style.min.css">

    <noscript>
        <meta http-equiv="refresh"
        content="0; url=http://im.clubcoder.tk/noscript.html">
    </noscript>
    <style>
    
    </style>
    <title>Club Coder Instant Messenger</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

</head>
<body>
  <!-- Stair Loader -->
            <style>
.overlay:before,.txt{display:inline-block;vertical-align:middle}.overlay{position:absolute;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.85);background:url('data:;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAYAAABytg0kAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAABl0RVh0U29mdHdhcmUAUGFpbnQuTkVUIHYzLjUuNUmK/OAAAAATSURBVBhXY2RgYNgHxGAAYuwDAA78AjwwRoQYAAAAAElFTkSuQmCC')\9;z-index:9999;color:#fff;text-align:center}.loader,.txt{position:relative}.overlay:before{content:'';height:100%;margin-right:-.25em}.txt{padding:10px 15px;font-weight:700}html{height:100%}.loader{width:75px;height:100px}.loader__ball,.loader__bar{position:absolute;width:10px;background:#fff}.loader__bar{bottom:0;height:50%;-webkit-transform-origin:center bottom;transform-origin:center bottom;box-shadow:1px 1px 0 rgba(0,0,0,.2)}.loader__bar:nth-child(1){left:0;-webkit-transform:scale(1,.2);transform:scale(1,.2);-webkit-animation:barUp1 4s infinite;animation:barUp1 4s infinite}.loader__bar:nth-child(2){left:15px;-webkit-transform:scale(1,.4);transform:scale(1,.4);-webkit-animation:barUp2 4s infinite;animation:barUp2 4s infinite}.loader__bar:nth-child(3){left:30px;-webkit-transform:scale(1,.6);transform:scale(1,.6);-webkit-animation:barUp3 4s infinite;animation:barUp3 4s infinite}.loader__bar:nth-child(4){left:45px;-webkit-transform:scale(1,.8);transform:scale(1,.8);-webkit-animation:barUp4 4s infinite;animation:barUp4 4s infinite}.loader__bar:nth-child(5){left:60px;-webkit-transform:scale(1,1);transform:scale(1,1);-webkit-animation:barUp5 4s infinite;animation:barUp5 4s infinite}.loader__ball{bottom:10px;left:0;height:10px;border-radius:50%;-webkit-animation:ball 4s infinite;animation:ball 4s infinite}@-webkit-keyframes ball{0%,100%{-webkit-transform:translate(0,0);transform:translate(0,0)}5%{-webkit-transform:translate(8px,-14px);transform:translate(8px,-14px)}10%{-webkit-transform:translate(15px,-10px);transform:translate(15px,-10px)}17%{-webkit-transform:translate(23px,-24px);transform:translate(23px,-24px)}20%,70%{-webkit-transform:translate(30px,-20px);transform:translate(30px,-20px)}27%{-webkit-transform:translate(38px,-34px);transform:translate(38px,-34px)}30%{-webkit-transform:translate(45px,-30px);transform:translate(45px,-30px)}37%{-webkit-transform:translate(53px,-44px);transform:translate(53px,-44px)}40%{-webkit-transform:translate(60px,-40px);transform:translate(60px,-40px)}50%{-webkit-transform:translate(60px,0);transform:translate(60px,0)}57%{-webkit-transform:translate(53px,-14px);transform:translate(53px,-14px)}60%{-webkit-transform:translate(45px,-10px);transform:translate(45px,-10px)}67%{-webkit-transform:translate(37px,-24px);transform:translate(37px,-24px)}77%{-webkit-transform:translate(22px,-34px);transform:translate(22px,-34px)}80%{-webkit-transform:translate(15px,-30px);transform:translate(15px,-30px)}87%{-webkit-transform:translate(7px,-44px);transform:translate(7px,-44px)}90%{-webkit-transform:translate(0,-40px);transform:translate(0,-40px)}}@keyframes ball{0%,100%{-webkit-transform:translate(0,0);transform:translate(0,0)}5%{-webkit-transform:translate(8px,-14px);transform:translate(8px,-14px)}10%{-webkit-transform:translate(15px,-10px);transform:translate(15px,-10px)}17%{-webkit-transform:translate(23px,-24px);transform:translate(23px,-24px)}20%,70%{-webkit-transform:translate(30px,-20px);transform:translate(30px,-20px)}27%{-webkit-transform:translate(38px,-34px);transform:translate(38px,-34px)}30%{-webkit-transform:translate(45px,-30px);transform:translate(45px,-30px)}37%{-webkit-transform:translate(53px,-44px);transform:translate(53px,-44px)}40%{-webkit-transform:translate(60px,-40px);transform:translate(60px,-40px)}50%{-webkit-transform:translate(60px,0);transform:translate(60px,0)}57%{-webkit-transform:translate(53px,-14px);transform:translate(53px,-14px)}60%{-webkit-transform:translate(45px,-10px);transform:translate(45px,-10px)}67%{-webkit-transform:translate(37px,-24px);transform:translate(37px,-24px)}77%{-webkit-transform:translate(22px,-34px);transform:translate(22px,-34px)}80%{-webkit-transform:translate(15px,-30px);transform:translate(15px,-30px)}87%{-webkit-transform:translate(7px,-44px);transform:translate(7px,-44px)}90%{-webkit-transform:translate(0,-40px);transform:translate(0,-40px)}}@-webkit-keyframes barUp1{0%,100%,40%{-webkit-transform:scale(1,.2);transform:scale(1,.2)}50%,90%{-webkit-transform:scale(1,1);transform:scale(1,1)}}@keyframes barUp1{0%,100%,40%{-webkit-transform:scale(1,.2);transform:scale(1,.2)}50%,90%{-webkit-transform:scale(1,1);transform:scale(1,1)}}@-webkit-keyframes barUp2{0%,100%,40%{-webkit-transform:scale(1,.4);transform:scale(1,.4)}50%,90%{-webkit-transform:scale(1,.8);transform:scale(1,.8)}}@keyframes barUp2{0%,100%,40%{-webkit-transform:scale(1,.4);transform:scale(1,.4)}50%,90%{-webkit-transform:scale(1,.8);transform:scale(1,.8)}}@-webkit-keyframes barUp3{0%,100%{-webkit-transform:scale(1,.6);transform:scale(1,.6)}}@keyframes barUp3{0%,100%{-webkit-transform:scale(1,.6);transform:scale(1,.6)}}@-webkit-keyframes barUp4{0%,100%,40%{-webkit-transform:scale(1,.8);transform:scale(1,.8)}50%,90%{-webkit-transform:scale(1,.4);transform:scale(1,.4)}}@keyframes barUp4{0%,100%,40%{-webkit-transform:scale(1,.8);transform:scale(1,.8)}50%,90%{-webkit-transform:scale(1,.4);transform:scale(1,.4)}}@-webkit-keyframes barUp5{0%,100%,40%{-webkit-transform:scale(1,1);transform:scale(1,1)}50%,90%{-webkit-transform:scale(1,.2);transform:scale(1,.2)}}@keyframes barUp5{0%,100%,40%{-webkit-transform:scale(1,1);transform:scale(1,1)}50%,90%{-webkit-transform:scale(1,.2);transform:scale(1,.2)}}

    </style>
    <script>
    $(document).ready(function(){
        $("#loading-animation").remove()
    })
    </script>
    <div class="overlay" id="loading-animation">
        <div class="txt">
        <div class="loader">
        
  <div class="loader__bar"></div>
  <div class="loader__bar"></div>
  <div class="loader__bar"></div>
  <div class="loader__bar"></div>
  <div class="loader__bar"></div>
  <div class="loader__ball"></div>
  <p>
                Loading... Please Wait

        </p></div></div>
      </div>
        <!-- end of Loader -->
  <div class="container">


    <div class="row">
      <div class="box">
        <div class="col-lg-12">
          <br>

          <h1 class="intro">Welcome to the Club Coder instant messenger</h1>
          <br>                              <p class="options popout-hidden">Version 2.2.1</p>

                    <div id="message" class="col-lg-12"></div>

                    <br>
                    <textarea placeholder="type a message!" id="text" class="form-control" class="text-ab45"></textarea>
                    <br>
                    <button class="form-control btn btn-success transparent" id="submit">Enter</button>
                    <div class="popout-hidden options">
                        <div><p> <a id="popout">Pop Out <i class="fa fa-external-link"></i></a>
                         | <span><a id="view-image">View Image <i class="fa fa-picture-o"></i>
</a></span> | <a onclick="slide()">Change Image</a> | <a id="logout">Logout <i class="fa fa-sign-out"></i></a> | <a id="help">Help <i class="fa fa-info-circle"></i></a> | <input type="checkbox" id="autoscroll" value="true" checked>Autoscroll on new
</p></div>
                     </div>

                     <footer><div class="container"><div class="col-lg-12 options"><p>&copy; 2015-2016 Jeffrey Meng. All Rights Reserved.</p></div></div></footer>

                     
                     <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <script src="markdown.js"></script>

                     <script src="script.min.js"></script>
                     <script src="timeago.min.js" type="text/javascript"></script>

 </div>
</div>
</div>

</div>
<div id="myModal" class="modal fade modal-wide" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Help</h4>
      </div>
      <div class="modal-body">
        <p>Type in a message and press enter or click enter to send. Messages cannot be just a space, empty, or start with a slash(If a message starts with a slash, it is a command see below). To create a new line, type in \n note. Markdown is enabled(see below).</p>
        <h4>Commands</h4>
        <p>There is currently only one command you can use.</p>
        <p>
            /msg sends a private message. It's syntax is: <code>/msg[recipents] &lt;message></code>, where <cpde>recipents</code> is a space seperated list of recipents, For example: <code>/msg[joe bob billy] &lt;message></code> sengs a message to joe, bob, and billy only. No one else can see it.
            The <code>&lt;message></code> parameter is your message. for example: if you do <code>/msg [billy] Hello. Only you can see this.</code><br>
            Only billy and you will be able to see the message, which is:  Hello. Only you can see this.
        </p>
        <h4>Markdown</h4>
<iframe src="http://tinyurl.com/jcjj75s" class="modal-wide" style="width:95%;height:1000px;">Loading</iframe>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>
</body>

</html>
